# RoA2 Portrait Shuffler (Rust + WASM + React)

A dual-panel character randomizer built with **Rust**, **WASM**, and **React**, designed for quickly generating “sets” of shuffled Rivals of Aether 2 character portraits. Each side randomizes independently and supports toggling characters grey or un-grey by clicking them.

This project also uses a **pyramid layout** to visually organize portraits in a 5 / 4 / 3 / 2 pattern.

---

## Features

### ✔ Two independent randomizers
- **Player 1** and **Player 2** areas  
- Each panel has its own **Randomize** and **Undo** buttons  
- Undo restores the previous arrangement  

### ✔ Rust-powered shuffling
- Portrait indices are shuffled using a Rust function compiled into WASM  
- JavaScript triggers the shuffle via exported WASM bindings  

### ✔ Click to Greyscale
- Clicking any portrait toggles grayscale on/off  
- Greyscale state persists through shuffles  

### ✔ Pyramid Layout
Each side displays portraits in a fixed layout:

```
⬤ ⬤ ⬤ ⬤ ⬤
  ⬤ ⬤ ⬤ ⬤
    ⬤ ⬤ ⬤
      ⬤ ⬤
```

### ✔ Responsive UI
- Side-by-side layout on wide screens  
- Automatically collapses into vertical stacking on small screens  
- Both pyramids remain centered in their respective columns  

---

## Tech Stack

| Layer | Technology |
|-------|------------|
| UI Framework | React (Vite) |
| Shuffle Logic | Rust + wasm-bindgen + wasm-pack |
| Portraits | Static assets in `/public/portraits` |
| State Management | useState + custom logic |
| Build Tools | Vite bundler, wasm-pack (`--target web`) |

---

## Project Structure

```
portrait_shuffler/
│
├── src/
│   ├── App.tsx
│   ├── components/
│   │   └── portrait-shuffler.tsx
│   ├── assets/
│   │   └── portrait-constants.ts
│   └── pkg/               # Generated by wasm-pack
│
├── public/
│   └── portraits/         # Character images
│
├── Cargo.toml             # Rust crate config
└── src/lib.rs             # Rust shuffle function
```

---

## How to Build & Run

### 1. Install Rust and wasm-pack

```bash
brew install rustup
rustup-init

cargo install wasm-pack
```

### 2. Build the WASM module

From the project root:

```bash
cd /Users/guadac01/Repos/ironman-randomizer/portrait_shuffler

wasm-pack build \
    --target web \
    --out-dir frontend/src/pkg \
    --out-name portrait_shuffler
```

This generates:

```
portrait_shuffler.js
portrait_shuffler_bg.wasm
portrait_shuffler.d.ts
```

### 3. Install frontend deps

```bash
cd frontend
npm install
```

### 4. Run the dev server

```bash
npm run dev
```

Open:

```
http://localhost:5173/
```

---

## How the WASM Shuffle Works

Rust (`src/lib.rs`):

```rust
#[wasm_bindgen]
pub fn shuffled_indices(len: usize, seed: u32) -> Vec<u32> {
    let mut rng = StdRng::seed_from_u32(seed);
    let mut indices: Vec<u32> = (0..len as u32).collect();
    indices.shuffle(&mut rng);
    indices
}
```

- The Rust function returns a permutation of 0..N.
- JS uses this to reorder portrait indices.
- Shuffles are independent for each panel.

---

## Portrait Greyscaling

Each portrait index has a boolean:

```ts
const [greyed, setGreyed] = useState<boolean[]>(
    () => portraits.map(() => false)
);
```

Clicking toggles grayscale via CSS:

```css
filter: grayscale(100%);
```

---

## Undo Behavior

Before each shuffle:

```ts
setPreviousOrder(order);
```

Undo restores it:

```ts
setOrder(previousOrder);
setPreviousOrder(null);
```

Undo is per-shuffler and does not affect the other side.

---

## Responsive Layout

The app switches between horizontal and vertical layouts depending on window width:

```ts
const BREAKPOINT = 1120;
setIsVertical(window.innerWidth < BREAKPOINT);
```

Portrait pyramids remain centered using:

```css
align-self: center;
margin-left: rowIndex * 40px;
```

---

## Adding or Renaming Characters

Edit:

```
src/assets/portrait-constants.ts
```

Example:

```ts
export const PORTRAITS = [
	"/portraits/240px-RoA2_Icon_Absa.webp",
	"/portraits/240px-RoA2_Icon_Ranno.webp",
	...
];
```

Images in `public/portraits` load automatically.

---

## Known Limitations

- Undo only saves **one** previous state  
- Pyramid indent requires tuning if portrait sizes change  
